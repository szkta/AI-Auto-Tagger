# 🏷️ Gemini AI Auto Tagger for Windows

GoogleのAIモデル「Gemini 1.5 Flash」を使用して、大量の画像や動画に自動でタグ付けを行うWindows用ツールです。
生成されたタグはWindowsのエクスプローラーのプロパティ（詳細タブ）に書き込まれるため、Windows標準の検索機能でファイルを検索できるようになります。

## ✨ 主な機能

* **多形式対応:** JPEG (`.jpg`), PNG (`.png`), GIF (`.gif`), MP4 (`.mp4`) に対応。
* **Windows検索完全対応:** `XPKeywords`, `Subject`, `Keywords` のメタデータ領域に同時書き込みを行うため、エクスプローラーでの検索が確実に機能します。
* **日本語対応:** Windows環境特有の文字化けを防ぐ処理を実装済み。日本語タグで検索可能です。
* **高速並列処理:** マルチスレッド処理により、複数のファイルを同時にAI解析・書き込みします。
* **GUI操作:** Pythonスクリプトですが、ブラウザベースのGUI（Streamlit）で直感的に操作できます。
* **タグ一括削除機能:** 指定フォルダ内のタグを全てクリーンアップする機能も搭載。

## ⚙️ 前提条件

このツールを使用するには以下の準備が必要です。

1.  **Python 3.10以上** のインストール
2.  **Google AI Studio API Key** の取得（Gemini API用）
3.  **ExifTool** のインストール（後述）

## 🚀 インストール手順

### 1. 必要なPythonライブラリのインストール
ターミナル（コマンドプロンプト）で以下のコマンドを実行してください。

```bash
pip install streamlit google-generativeai
```

### 2. ExifToolのセットアップ（重要）
メタデータの書き込みに ExifTool を使用します。

1. [[ExifTool公式サイト]](https://exiftool.org/) から `Windows Executable` (zipファイル) をダウンロードします。

2. zipを解凍すると `exiftool(-k).exe` というファイルが入っています。

3. これを `exiftool.exe` にリネームします（`(-k)`を削除）。

4. `exiftool.exe`、`exiftool_files`フォルダ を、このツールの `app.py` と同じフォルダに配置してください。

- または、Windowsのシステム環境変数 PATH に exiftool の場所を追加しても動作します。

### 3. フォルダ構成の確認
最終的に以下のような配置になっていればOKです。

```Plaintext
/my-tagger-app
  ├─ app.py           # メインプログラム
  ├─ exiftool.exe     # リネーム済みのツール
  ├─ /exiftool_files     # ツールのソースフォルダ
  └─ /images          # タグ付けしたい画像フォルダ（場所は任意）
```

## 📖 使い方
### 起動
以下のコマンドでアプリを起動します。

```Bash
streamlit run app.py
```

ブラウザが自動的に立ち上がり、操作画面が表示されます。

### タグ付けの手順
1. **Gemini API Key**: Google AI Studioで取得したキーを入力します。

2. **対象フォルダパス**: 画像が入っているフォルダのパスを入力します（例: `./images` や `C:\Photos\Trip`）。

3. **同時処理数**: 必要に応じてスライダーを調整します（推奨: 4〜5）。

4. **「タグ付け開始」** ボタンをクリックします。

処理ログとプレビューが表示され、完了するとプログレスバーが100%になります。

### タグの削除
誤ってタグ付けした場合などは、「🗑️ タグ一括削除」タブに切り替え、対象フォルダを指定して削除ボタンを押してください。

## ⚠️ 注意事項と免責
- バックアップ推奨: このツールは画像・動画ファイルのメタデータ領域を直接書き換えます（`-overwrite_original` オプションを使用）。必ず大切なデータのバックアップを取ってから実行してください。

- APIコスト: Gemini 1.5 Flashは非常に安価ですが、数万枚を処理する場合は従量課金（Pay-as-you-go）プランの利用を推奨します。無料枠の場合、APIの呼び出し回数制限（Rate Limit）によりエラーが発生しやすくなります。

- 動画の処理: 動画ファイル（MP4）はアップロードと解析に時間がかかるため、画像のみの場合に比べて処理速度が低下します。

## 🛠️ トラブルシューティング
- 文字化けする: `app.py` が最新版（文字化け対策済み）であることを確認してください。

- exiftoolが見つからない: `exiftool.exe` が `app.py` と同じ場所にあるか、ファイル名が正しいか（`(-k)`が残っていないか）確認してください。

- API Error: "429 Too Many Requests" が出る場合は、APIの無料枠制限に達しています。処理速度（スレッド数）を下げるか、課金設定を行ってください。

## License
MIT License / Unlicense (自由に改変・利用可能です)
